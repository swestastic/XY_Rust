<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>XY Model Simulation</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>

    <header class="page-title container">
      <h1>XY Model Simulation</h1>
    </header>

    <div class="main-content container">
      <div class="controls-panel panel">
      <h2 class="panel-title">Simulation Controls</h2>
      
      <div class="controls-row">
        <div class="field-col">
          <label class="label">Temperature
            <input type="number" id="temp-value" min="0.1" max="5.0" step="0.01" value="0.87" class="num">
          </label>
          <input type="range" id="temp-slider" min="0.1" max="5.0" step="0.01" value="0.87" class="range">
        </div>
        
        <div class="field-col">
          <label class="label">Coupling J
            <input type="number" id="j-value" min="-2.0" max="2.0" step="0.01" value="1.0" class="num">
          </label>
          <input type="range" id="j-slider" min="-2.0" max="2.0" step="0.01" value="1.0" class="range">
        </div>
        
        <div class="field-col">
          <label class="label">External Field h
            <input type="number" id="h-value" min="-2.0" max="2.0" step="0.01" value="0.0" class="num">
          </label>
          <input type="range" id="h-slider" min="-2.0" max="2.0" step="0.01" value="0.0" class="range">
        </div>
        
        <div class="field-col">
          <label class="label">Lattice Size
            <select id="lattice-size" class="select">
              <option value="8">8x8</option>
              <option value="16">16x16</option>
              <option value="32">32x32</option>
              <option value="64" selected>64x64</option>
              <option value="128">128x128</option>
              <option value="256">256x256</option>
              <option value="512">512x512</option>
            </select>
          </label>
        </div>
        
        <div class="field-col">
          <label class="label">Algorithm
            <select id="algorithm" style="margin-left: 8px; font-size: 1.1em;" class="select">
              <option value="metropolis" selected>Metropolis</option>
              <option value="metropolis-reflection">Metropolis Reflection</option>
              <option value="overrelaxation">Overrelaxation</option>
            </select>
          </label>
        </div>
      </div>
      
      <div class="controls-row">
        <div class="field-col">
          <label class="label">Sweeps per frame</label>
          <div class="row" style="display: flex; align-items: center; gap: 8px;">
            <input type="range" id="skip-slider" min="1" max="100" step="1" value="1" class="range">
            <input type="number" id="skip-input" min="1" max="100" step="1" value="1" class="num">
          </div>
        </div>
        
        <div class="row row-buttons">
          <button id="reset-btn" class="btn">Reset</button>
          <button id="reset-data-btn" class="btn">Reset Data</button>
          <button id="toggle-viz-btn" class="btn btn-toggle">Switch to Quiver View</button>
        </div>
      </div>
    </div>
  
    <div class="sweep-panel panel">
      <h2 class="panel-title">Sweep Controls</h2>
      <div id="sweep-controls" class="controls-row">
        <label class="label">T<sub>init</sub>: <input type="number" id="sweep-t-init" min="0.1" max="5.0" step="0.01" value="2.5" class="num"></label>
        <label class="label">T<sub>final</sub>: <input type="number" id="sweep-t-final" min="0.1" max="5.0" step="0.01" value="1.5" class="num"></label>
        <label class="label">ΔT: <input type="number" id="sweep-t-step" min="0.01" max="1.0" step="0.01" value="-0.1" class=" num"></label>
        <label class="label">Measurement sweeps: <input type="number" id="sweep-n-sweeps" min="1" max="10000" step="1" value="1000" class="num"></label>
        <label class="label">Warmup sweeps: <input type="number" id="sweep-n-warmup" min="0" max="10000" step="1" value="1000" class="num"></label>
        <label class="label">Decorrelation sweeps: <input type="number" id="sweep-n-decor" min="0" max="10000" step="1" value="5" class="num"></label>
  <button id="run-sweep-btn" class="btn">Run T Sweep</button>
  <button id="download-csv-btn" class="btn btn-muted" disabled>Download CSV</button>
      </div>
    </div>
  
    <div class="stage">
      <div style="display: flex; flex-direction: column; align-items: center;">
        <canvas id="canvas" class="sim-canvas"></canvas>
        <div id="colorbar-container" class="colorbar-container">
          <div class="colorbar-labels">
            <span>0</span>
            <span>π/2</span>
            <span>π</span>
            <span>3π/2</span>
            <span>2π</span>
          </div>
          <canvas id="colorbar" class="colorbar-canvas"></canvas>
          <div class="colorbar-title">Spin Angle</div>
        </div>
      </div>
      
      <div style="display: flex; flex-direction: column; align-items: center;">
        <canvas id="live-plot" width="400" height="400" class="plot-canvas"></canvas>
        
        <div class="plot-controls">
          <label id="plot-label" class="label dropdown">
            Plot:
            <select id="plot-type" class="select">
              <option value="energy" selected>Energy per Site</option>
              <option value="magnetization">Magnetization per Site</option>
              <option value="acceptance_ratio">Acceptance Ratio</option>
              <option value="no_plot">None (Disable Plot)</option>
            </select>
          </label>

          <span class="readout">E = <span id="energy-value">0.0000</span> &nbsp; M = <span id="magnetization-value">+0.0000</span></span>
          <span class="readout">Acceptance Ratio: <span id="acceptance-ratio">0</span></span>
          <span class="readout">Sweeps/sec: <span id="sweeps-per-sec">0</span></span>
        </div>
      </div>
    </div>
      </div>
      <script type="module" src="./index.js"></script>
    </div> <!-- closes main-content div -->

  <!-- Bottom Section: About, TODO, Completed -->
  <div class="bottom container">
    <div class="about-col">
      <div id="simulation-description" class="info panel">
        <h2>About the Simulation</h2>
        <div class="prose">
          <p>This simulation is written in Rust and compiled to WebAssembly (WASM) for performance. 
          It implements the 2D XY model with periodic boundaries using the Metropolis-Hastings algorithm.
          The website is written in plain HTML, CSS, and JavaScript.
          </p>
          <!-- <p><a href="algorithms.html" class="link">→ Learn more about the algorithms used in this simulation</a></p> -->
          <ul>
            <li>T slider adjusts temperature of the simulation. Default value is the critical Temperature - approximately 0.866 J/k (k=1 for this simulation)</li>
            <li>J slider adjusts the coupling constant between spins. The default value is 1.0.
                Positive J favors alignment (ferromagnetic) while negative J favors anti-alignment (antiferromagnetic).
            </li>
            <li>h slider adjusts the external magnetic field applied to the system. The default value is 0.0.
                Positive h favors upwards spins while negative h favors downwards spins.
            </li>
            <li>The sweeps per frame slider allows users to control how many Monte Carlo sweeps are performed between each frame update, affecting the speed of the simulation.
                The simulation speed is tied to the screen refresh rate, so it will be capped on monitors with lower refresh rates (typically 60Hz, 120Hz, or 144Hz).
                Making this value larger will speed up the simulation significantly since it will not have to render as often, but visually it will be less smooth, especially for larger lattices.
            </li>
            <li>Lattice size dropdown chooses size adjustment from 8x8 to 512x512</li>
            <li>Plot dropdown chooses which quantity to plot over time: energy per site, magnetization per site, acceptance ratio, or disable the plot entirely.</li>
            <li>Reset button reinitializes the lattice with random spins and resets the simulation statistics.</li>
          </ul>
          </p>
        </div>
      </div>
      
      <div id="model-description" class="info panel">
        <h2>About the XY Model</h2>
        <div class="prose">The XY model is a mathematical model of ferromagnetism in statistical mechanics. 
          It consists of continuous variables that represent magnetic dipole moments of atomic spins, which can point in any direction in a plane. 
          The model helps to understand phase transitions and critical phenomena in physics.</div>
      </div>
    </div>
    
    <div class="todo-col">
      <div class="panel todo">
        <h3>TODO List</h3>
        <ul>
          <li>Implement more algorithms (Heatbath, Swendsen-Wang, Wolff, etc.)</li>
          <li>Documentation/information about algorithms</li>
          <li>Improve UI/UX design</li>
          <li>Add more plot options (e.g. specific heat, susceptibility)</li>
          <li>Live readout for average cluster size</li>
          <li>Better axes and higher resolution for plots</li>
          <li>Average energy and magnetization, &lt;E&gt; and &lt;M&gt; live readouts</li>
        </ul>
      </div>
    </div>
  </div>
  </body>
</html>